1
Concealed movement
2
Moving the unit to a target point as concealed as possible from the other side's units - in order not to be detected by them, while utilizing the underground medium as much as possible and subject to operational considerations.
3
Principle route
4
A route that defines the implied target point (end of the route) and the movement corridor.
The actual route of movement is determined dynamically during the movement, according to the location of the enemy detected in the area.
5
The unit is too far from the principle route (it is not within the movement corridor defined by it)
6
*** Bypass: Allowing a deviation of the unit's location from the movement corridor by up to 99 meters to cover up a problem in the atomic function FindRouteToPolyline (returning a route that deviates from the search area polygon).
7
End mode
8
How to end the movement:
'At target' - the movement will end preferably at the target point, with the unit above ground.
'At a nearby underground opening' - if it is possible to utilize the underground medium, the movement will end at the closest underground passage opening to the target point, with the unit underground.
9
On encounter
10
In case of an encounter with an enemy in overground movement - whether to stop or to continue moving while firing (movement and fire).
Default - "Continue".
11
0. General definitions:

- "The target" is the end point of the "specified principle route".
- "Should end at a nearby underground opening" if the specified "end mode" is 'at a nearby underground opening' and the closest underground opening to the target is not empty.
- "Actual target" is the closest underground opening to the target if "should end at a nearby underground opening", otherwise - it is the target.

- The unit is blocked in a tunnel ("is in a tunnel from which it is impossible to exit") if it is underground and no underground route was found.


In each iteration:
=== Underground movement ===
Definitions:
- The underground route is an underground route from the unit's current location (underground or overground) to the actual target.
The search area for the underground route is a corridor with a width of "the width of the movement corridor" based on the specified principle route.
The search area for the entrance to the underground (when the unit is above ground) is a corridor based on the remainder of the specified principle route from the unit's current location.

- "Underground movement is being performed" if the unit can move underground, an underground route was found, and it is worthwhile if the unit is not already underground.
- An underground route is worthwhile if its gross price is greater than the price of the overground route (which is equal to its length).
The gross price of the underground route is composed of:
a. Net price = the length of the route divided by the "underground preference factor".
b. Entry price = the distance from the current location to the entry point.
c. Exit price = the distance from the exit point to the actual target.


1. If the unit is not underground and "underground movement is being performed": ("should enter the underground before using the underground route")
a. Movement to a point with the parameters:
- Entry point: "the entry point [to the underground] of the underground route
- Sector boundaries: "the search corridor for an entry point [to the underground]"
- Passage in a built-up area: 'desirable'
- Movement on axes: 'not desirable'
- Concealment from enemy units: 'very important'
b. Entry into the underground

2. If "underground movement is being performed" and the underground route is not empty: ("should move along the underground route")
Underground movement on the "[actual] underground route".

3. If "underground movement is being performed" and the route does not end at a point close to the target if this is the actual target: ("should exit the underground [at the end point of the underground route]")
Exit from the underground



=== Overground movement ===
Definitions:
- The overground route is a route from the unit's current location to the actual target.
- "The advance segment along the overground route" is a segment with a length of "overground advance distance" from the beginning of the overground route if the unit can move underground, otherwise - it is the entire overground route.

4. If "underground movement is not being performed" and the unit is not blocked in a tunnel: ("the overground route should be used")
Movement along a route with the parameters:
- Route: "the advance segment along the overground route"
- Passage in a built-up area: 'desirable'
- Movement on axes: 'not desirable'
- Concealment from enemy units: 'very important'

5. If "the overground route should be used" and also "the advance segment along the overground route" ends at the closest underground opening to the target, if this is the actual target: ("should enter the underground at the end of movement on an overground route"):
Entry into the underground.



=== Completion ===
6. If the unit is blocked in a tunnel ("is in a tunnel from which it is impossible to exit"):
Sending a self-report with a failure message.

7. If an underground movement was performed and the route ended at the actual target, that an overground movement was performed and the unit reached the end of the route, or that the unit is blocked in a tunnel: ("concealed movement has ended")
Remembering "concealed movement has ended" - 'yes' in the unit's memory and finishing.
12
The entire unit
13
Movement to the entry point to the underground
14
Movement along the underground route
15
Advancement on the overground route
16
Concealed movement failed: the unit is in a tunnel from which all the exit openings are outside the movement corridor.
17
Remembering an indication for completion
18
Width of the movement corridor
19
Underground preference factor: how many meters at most it is worth moving underground to save one meter above ground.
20
Overground advance distance [on the reference route]
21
The target
22
Width of the movement corridor in meters
23
The movement corridor
24
The unit is capable of operating underground
25
The unit is not capable of operating underground
26
The unit is underground
27
Current location
28
The closest underground opening [to the target]
29
Should end at a nearby underground opening
30
Actual target
31
Known enemy detections
32
Overground route [to the actual target]
33
The rest of the principle route
34
The centerline of the search corridor for an entry point
35
Search corridor for an entry point [to the underground]
36
Target constraint for overground
37
Underground route [given an overground origin]
38
Underground route [given an underground origin]
39
[Actual] underground route
40
Net price of the underground route = its length divided by the underground preference factor
41
The entry point [to the underground] of the underground route
42
Entry price = the distance from the current location to the entry point
43
The exit point [from the underground] of the underground route
44
Exit price = the distance from the exit point to the actual target
45
Gross price of the underground route = entry price + net price + exit price
46
Price of the overground route = its length
47
The underground route is worthwhile
48
Underground movement is being performed
49
Should enter the underground before using the underground route
50
Should move along the underground route
51
The underground route ends at the closest underground opening [to the target]
52
Should exit the underground [at the end point of the underground route]
53
Is in a tunnel from which it is impossible to exit
54
The overground route should be used
55
Advance segment along the overground route
56
Should enter the underground at the end of movement on an overground route
57
Completion based on an underground route
58
Completion based on an overground route
59
Concealed movement has ended
60
Concealed movement to a point
61
Principle route to the target
62
Sub-unit
63
Refill to standard.
64
Movement corridor width
65
The width of the movement corridor (in meters) corresponding to the specified corridor width value.
66
Corridor width
67
Underground preference factor
68
How many meters at most it is worthwhile to move underground to save one meter above ground.
